{% extends "layout/frame.html" %}

{% block contents %}
{% load humanize %} <!-- 천단위에 콤마찍는 라이브러리-->


<div id="contain" class="container-fluid">

    <h1>포인트 관리</h1>
    <hr>
    <div class="container">
      <div>
        <label for="total_price">총 금액</label>
        <p id="total_price"></p>
      </div>
      <div>
        <p id="result_count">총 {{ profile.count }}개</p>
        <label for="total_point">포인트</label>
        <p id="total_point"></p>
      </div>
      <button id="btn" class="btn btn-primary" style="font-size:0.5vw;" onclick="a()">결제하기</button>
    </div>
    <hr>

    <table class="table align-items-center">
        <thead>
          <tr>
            <th width="150px">품명</th>
            <th>수량</th>
            <th>가격</th>
            <th>포인트</th>
            <th>Unit</th>
            <th>비고</th>
            <!-- <th>hide1</th>
            <th>hide2</th> -->

            <!-- <th>수정</th> -->
          </tr>
        </thead>
        <tbody>
        {% for file in profile %}
          <tr>
            <td width="150px">{{ file.title }}</td>
            <td id="product"></td>
            <td id="price">{{ file.price|intcomma}}원</td> <!-- 천단위에 콤마찍는 라이브러리-->
            <td id="point">{{ file.point }}P</td>
            <td id="per"></td>
            <td id="product_price">금액표시</td>
            <!-- <td id="hide1"></td>
            <td id="hide2"></td> -->
            <!-- <td><a href="{% url 'mylist:modify' file.id %}" class="btn btn-outline-secondary btn-sm" style="font-size:0.5vw; ">수정</a></td> -->
          </tr>
       {% endfor %}
        </tbody>
        <!-- {{ file.image.url }}<br> -->
    </table>
    <a href="{% url 'mylist:write' %}" class="btn btn-primary"  style="font-size:0.5vw;">신규 작성</a>
</div>
<script>
  
  let product = document.querySelectorAll('#product');
  let product_price = document.querySelectorAll('#product_price');
  let numberText = document.querySelectorAll('#numberText');

  let per = document.querySelectorAll('#per');

  let price = document.querySelectorAll('#price');
  let point = document.querySelectorAll('#point');

  let result_price = document.querySelector('#result_price');

  let total_point = document.querySelector('#total_point');
  let total_price = document.querySelector('#total_price');


  let hide1 = document.querySelectorAll('#hide1');
  let hide2 = document.querySelectorAll('#hide2');


  function a(){
    const prices = document.querySelectorAll("#price");  // querySelectorAll은 배열로 반환 이걸로 해야전체를 찾을수 있다 ㅠㅠ
    const products = document.querySelectorAll("#product_price");

    for (let i = 0; i <73; i++) {
    let price_value = price[i].textContent;
    price_value = price_value.replace(/,/g, ''); // 콤마 제거
    price_value = parseInt(price_value); // 문자열을 숫자로 변환

    let point_value = point[i].textContent;
    point_value = point_value.replace(/point/g, ''); // point 제거
    point_value = parseInt(point_value); // 문자열을 숫자로 변환

      sum1 = 0;
      //sum1 += parseInt(prices[i].innerHTML);
      sum1 += Number(point_value+price_value);
      console.log(sum1);
    };
    
  
};

  for (let i = 0; i <73; i++) {

      // "+" 버튼 생성
      let addButton = document.createElement('button');
      addButton.textContent = '+';
      product[i].appendChild(addButton);

      // 숫자 텍스트 생성
      let numberText = document.createTextNode(0);
      numberText.id = 'numberText';
      product[i].appendChild(numberText);

      // "-" 버튼 생성
      let minusButton = document.createElement('button');
      minusButton.textContent = '-';
      product[i].appendChild(minusButton);

      // "+" 버튼에 이벤트 리스너 추가
      addButton.addEventListener('click', function() {
        let number = parseInt(numberText.textContent);
        number++;
        numberText.textContent = number;
      });

      // "-" 버튼에 이벤트 리스너 추가
      minusButton.addEventListener('click', function() {
        let number = parseInt(numberText.textContent);
        number--;
        numberText.textContent = number;
      });


      let price_value = price[i].textContent;
      price_value = price_value.replace(/,/g, ''); // 콤마 제거
      price_value = parseInt(price_value); // 문자열을 숫자로 변환

      let point_value = point[i].textContent;
      point_value = point_value.replace(/point/g, ''); // point 제거
      point_value = parseInt(point_value); // 문자열을 숫자로 변환
      
      
      let point_per = price_value/point_value;
      //소수점 0자리까지 표시
      point_per = point_per.toFixed(0);

      per[i].innerHTML = point_value ==0 ? "포인트없음" : point_per.toLocaleString() + '원/P';

      // 가격과 숫자를 곱한 값을 보여주는 부분
      document.addEventListener('click', function(e) {
        if (e.target.tagName === 'BUTTON') {
          let priceV = price[i].textContent;
          priceV = priceV.replace(/,/g, ''); // 콤마 제거
          priceV = parseInt(priceV); // 문자열을 숫자로 변환

          let priceP = point[i].textContent;
          priceP = priceP.replace(/point/g, ''); // point 제거
          priceP = parseInt(priceP); // 문자열을 숫자로 변환

          let number = numberText.textContent;
          number = parseInt(number);
          let result_price = priceV * number;
          let result_point = priceP * number;
          
          product_price[i].innerHTML = result_price.toLocaleString() + '원 / '+ result_point + 'P';
          //product_price[i].innerHTML = result_price.toLocaleString() + '원 / '+ result_point + 'P';



     /** forEach 사용하는 방법
           const arr = ['apple', 'banana', 'orange'];

            arr.forEach(item => {
              console.log(item);
            }); 
            
            typeof hide1[0].innerHTML

            hide1[0].innerHTML+hide1[0].innerHTML
            
            
            
          if (result_point > 0) {
            product_price[i].style.color = 'red';

            let total1 = 0;
            product_price[1].nodeValue;
            total1 += result_price;



            total_price.innerHTML = total1.toLocaleString() + '원';
            // total_point.innerHTML = total2 + 'P';;



          } else {
            product_price[i].style.color = 'black';
            result_price = result_price * -1;
          }**/




          
        }
      });
}


  
  //document.addEventListener('click', function(e) {
    /* if (e.target.id === 'hide_id') {
      e.target.style.display = 'none';
    } else {
      e.target.style.display = 'block';
    } */
    //window.location.href = '/modify'+e.target.id;
    //window.location.href = "{% url 'mylist:modify' 1 %}";
    


    function delete_confirm(){
        if(confirm("정말 삭제하시겠습니까?")){
            return true;
        }else{
            return false;
        }
    }
</script>
<style>
    form {
        width: 300px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;

    }
    table {
        width: 100%;
    }
    th{
      font-size: 10px;
      text-align: center;
      border-bottom: 0.2px solid grey;
    }
    td {
      font-size: 10px;
      padding: 5px;
      text-align: left;
      justify-items: center;
      align-items: center;
      border-bottom: 0.2px solid grey;
      cursor: pointer;
    }
    tr:hover {
      background-color: rgb(16, 201, 255);
      color: white;
    }

    @media screen and (min-width: 1000px){
      #contain{
        width: 90%;
      }
    }

    @media screen and (max-width: 430px){
      #hide_id{
        display: none;
      }
    }
</style>



{% endblock %}